{% extends "base.html" %}

{% block title %}Upload Resumes | CYGNUSA Elite-Hire{% endblock %}

{% block content %}
<div class="d-flex align-items-center justify-content-between mb-4">
    <div>
        <h1 class="mb-1">Upload Resumes</h1>
        <p class="text-muted">Evaluate candidates against technology role requirements.</p>
    </div>
</div>

<form action="/upload" method="post" enctype="multipart/form-data" class="card shadow-soft border-0 p-4">
    <div class="row g-4">
        <div class="col-lg-4">
            <label for="job_role" class="form-label">Job Role</label>
            <select id="job_role" name="job_role" class="form-select">
                <option value="">Select a role</option>
                {% for role in roles %}
                    <option value="{{ role }}" {% if role == selected_role %}selected{% endif %}>{{ role }}</option>
                {% endfor %}
            </select>
            <small class="text-muted">Requirements update automatically.</small>
        </div>
        <div class="col-lg-8">
            <div class="row g-3">
                <div class="col-md-6">
                    <div class="card h-100">
                        <div class="card-body">
                            <h6 class="text-muted">Required Skills</h6>
                            <div id="skills-preview"></div>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="card h-100">
                        <div class="card-body">
                            <h6 class="text-muted">Fundamentals</h6>
                            <ul id="fundamentals-preview" class="mb-0"></ul>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card h-100">
                        <div class="card-body">
                            <h6 class="text-muted">Experience</h6>
                            <h4 id="experience-preview">-</h4>
                            <small class="text-muted">years required</small>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card h-100">
                        <div class="card-body">
                            <h6 class="text-muted">Education</h6>
                            <p id="education-preview" class="mb-0">-</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <hr class="my-4">
    <div class="mb-3">
        <label for="resumes" class="form-label">Upload Resume PDFs</label>
        <input type="file" id="resumes" name="resumes" accept="application/pdf" multiple class="form-control">
    </div>
    <button type="submit" class="btn btn-primary">Evaluate Candidates</button>
</form>
{% endblock %}

{% block scripts %}
<script>
    const rolesData = {{ roles_data | tojson }};
    const roleSelect = document.getElementById("job_role");
    const skillsPreview = document.getElementById("skills-preview");
    const experiencePreview = document.getElementById("experience-preview");
    const educationPreview = document.getElementById("education-preview");
    const fundamentalsPreview = document.getElementById("fundamentals-preview");

    function renderPreview(role) {
        const data = rolesData[role];
        skillsPreview.innerHTML = "";
        fundamentalsPreview.innerHTML = "";
        if (!data) {
            experiencePreview.textContent = "-";
            educationPreview.textContent = "-";
            skillsPreview.innerHTML = "<span class='text-muted'>Select a role to view requirements.</span>";
            fundamentalsPreview.innerHTML = "<li class='text-muted'>Select a role to view fundamentals.</li>";
            return;
        }
        data.skills.forEach((skill) => {
            const badge = document.createElement("span");
            badge.className = "badge badge-skill";
            badge.textContent = skill;
            skillsPreview.appendChild(badge);
        });
        (data.fundamentals || []).forEach((item) => {
            const listItem = document.createElement("li");
            listItem.textContent = item;
            fundamentalsPreview.appendChild(listItem);
        });
        experiencePreview.textContent = data.experience || "-";
        educationPreview.textContent = data.education || "-";
    }

    roleSelect.addEventListener("change", (event) => {
        const role = event.target.value;
        renderPreview(role);
        if (role) {
            fetch("/set-role", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ role }),
            });
        }
    });

    renderPreview(roleSelect.value);
</script>
{% endblock %}
